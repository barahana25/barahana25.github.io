<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <title>ìœ„ì¹˜-ê¸°ë°˜ AR.js ë°ëª¨</title>

  <!-- A-Frame 1.3.0  â”€â”€ AR.js 3.4 ê¶Œì¥ ë²„ì „ -->
  <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>

  <!-- AR.js location-only + A-Frame glue -->
  <script src="https://raw.githack.com/AR-js-org/AR.js/3.4.5/three.js/build/ar-threex-location-only.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/3.4.5/aframe/build/aframe-ar.js"></script>

  <meta name="viewport"
        content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
  <style>
    body{margin:0;overflow:hidden;font-family:sans-serif}
  </style>
</head>

<body>
  <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€ í•˜ë‹¨ GPS ìƒíƒœ í‘œì‹œ ë°” â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div id="gpsBar"
       style="position:fixed;bottom:0;left:0;width:100%;
              padding:6px 10px;background:rgba(0,0,0,.65);
              color:#fff;font-size:14px;font-family:monospace;
              z-index:9999;text-align:center">
    ìœ„ë„Â·ê²½ë„ ë¡œë”© ì¤‘â€¦
  </div>

  <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€ AR Scene â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <a-scene
    vr-mode-ui="enabled:false"
    embedded
    renderer="antialias:true;alpha:true;logarithmicDepthBuffer:true"
    arjs="sourceType:webcam;videoTexture:true;debugUIEnabled:false">

    <!-- â˜… new-location-based ì¹´ë©”ë¼ -->
    <a-camera gps-new-camera rotation-reader></a-camera>

    <!-- â˜… ëª©í‘œ ì§€ì : 30 m ì•ˆì´ë©´ ë³´ì´ê³ , ì¹´ë©”ë¼ë³´ë‹¤ 2 m ìœ„ì— ë„ì›€ -->
    <a-box id="targetBox"
           gps-new-entity-place="latitude:36.35527; longitude:128.70246;"
           position="0 2 0"
           depth="2" height="5" width="5"
           material="color:#FF1493;opacity:0.9"
           look-at="[gps-new-camera]"
           visible="false"></a-box>
  </a-scene>

  <script>
    window.addEventListener('load', () => {
      const bar    = document.getElementById('gpsBar');
      const camera = document.querySelector('[gps-new-camera]');
      const box    = document.getElementById('targetBox');

      // ëª©í‘œ ì¢Œí‘œ(ìˆ˜ì •í•´ì„œ ì‚¬ìš©)
      const TARGET = { lat: 36.35527, lon: 128.70246 };

      // ê±°ë¦¬ ê³„ì‚°(Haversine)
      const toRad = d => d * Math.PI / 180;
      const distanceM = (p1, p2) => {
        const R = 6371000;
        const dLat = toRad(p2.lat - p1.lat);
        const dLon = toRad(p2.lon - p1.lon);
        const a =
          Math.sin(dLat/2)**2 +
          Math.cos(toRad(p1.lat)) * Math.cos(toRad(p2.lat)) *
          Math.sin(dLon/2)**2;
        return 2 * R * Math.asin(Math.sqrt(a));
      };

      /* ìœ„ì¹˜ ê°±ì‹  ì´ë²¤íŠ¸ */
      camera.addEventListener('gps-camera-update-position', e => {
        const { latitude, longitude, accuracy } = e.detail.position;

        /* â‘  í•˜ë‹¨ ë°” í…ìŠ¤íŠ¸ (accuracy ê°’ì´ ì—†ìœ¼ë©´ N/A) */
        const accText =
          Number.isFinite(accuracy) && accuracy > 0
            ? `Â±${Math.round(accuracy)} m`
            : 'ì •í™•ë„ N/A';

        bar.textContent =
          `ğŸ“ ${latitude.toFixed(5)}, ${longitude.toFixed(5)}  ${accText}`;

        /* â‘¡ ëª©í‘œì™€ì˜ ê±°ë¦¬â€•30 m ë¯¸ë§Œì´ë©´ ë°•ìŠ¤ í‘œì‹œ */
        const d = distanceM({ lat: latitude, lon: longitude }, TARGET);
        box.setAttribute('visible', d < 30000);
      });
    });
  </script>
</body>
</html>
