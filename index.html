<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <title>ìœ„ì¹˜-ê¸°ë°˜ AR.js ë°ëª¨</title>

  <!-- A-Frame + AR.js(3.4) location build -->
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <!-- three.js helper for location -->
  <script src="https://raw.githack.com/AR-js-org/AR.js/3.4.5/three.js/build/ar-threex-location-only.js"></script>
  <!-- aframe-ar.js-->
  <script src="https://raw.githack.com/AR-js-org/AR.js/3.4.5/aframe/build/aframe-ar.js"></script>

  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
  <style>body{margin:0;overflow:hidden;font-family:sans-serif}</style>
</head>

<body>
  <!-- í•˜ë‹¨ GPS í‘œì‹œì°½ -->
  <div id="gpsDisplay"
       style="position:fixed;bottom:0;left:0;width:100%;
              padding:6px 10px;background:rgba(0,0,0,.65);
              color:#fff;font-size:14px;font-family:monospace;
              z-index:9999;text-align:center;">
    ìœ„ë„Â·ê²½ë„ ë¡œë”© ì¤‘â€¦
  </div>

  <!-- AR ì¥ë©´ -->
  <a-scene
    embedded
    renderer="antialias:true;logarithmicDepthBuffer:true"
    arjs="sourceType: webcam; videoTexture: true; debugUIEnabled:false"
    vr-mode-ui="enabled:false"
  >
    <!-- GPS ì¹´ë©”ë¼ -->
    <a-camera gps-new-camera rotation-reader></a-camera>

    <!-- ëª©í‘œ ì§€ì (ì˜ˆ: í•™êµ ì•) 30 m ì•ˆì— ë“¤ì–´ì˜¤ë©´ ë³´ì¼ ë°•ìŠ¤ -->
    <a-box id="target-box"
           gps-new-entity-place="latitude: 36.14570; longitude: 128.39212;"
           depth="2" height="2" width="2"
           material="color:#FF1493;opacity:0.9"
           look-at="[gps-new-camera]"
           visible="false">
    </a-box>
  </a-scene>

  <script>
    window.addEventListener('load', () => {
      const camera = document.querySelector('[gps-new-camera]');
      const box    = document.getElementById('target-box');
      const info   = document.getElementById('gpsDisplay');

      // ëª©í‘œ ì¢Œí‘œ (ìˆ˜ì •í•´ì„œ ì‚¬ìš©)
      const TARGET = { lat: 36.14570, lon: 128.39212 };

      // Haversine ê±°ë¦¬ ê³„ì‚°
      const toRad = d => d * Math.PI / 180;
      const distM = (p1, p2) => {
        const R = 6371000;
        const dLat = toRad(p2.lat - p1.lat);
        const dLon = toRad(p2.lon - p1.lon);
        const a =
          Math.sin(dLat/2)**2 +
          Math.cos(toRad(p1.lat)) * Math.cos(toRad(p2.lat)) *
          Math.sin(dLon/2)**2;
        return 2 * R * Math.asin(Math.sqrt(a));
      };

      /*  GPS ì¢Œí‘œê°€ ê°±ì‹ ë  ë•Œë§ˆë‹¤ í˜¸ì¶œ */
      camera.addEventListener('gps-camera-update-position', (e) => {
        const { latitude, longitude, accuracy } = e.detail.position;

        // â‘  í™”ë©´ í•˜ë‹¨ì— ì¢Œí‘œ í‘œì‹œ
        info.textContent =
          `ğŸ“ ${latitude.toFixed(5)}, ${longitude.toFixed(5)}  Â±${Math.round(accuracy)} m`;

        // â‘¡ ëª©í‘œì™€ì˜ ê±°ë¦¬ ê³„ì‚° í›„ 30 m ì´ë‚´ë©´ ë°•ìŠ¤ í‘œì‹œ
        const d = distM({ lat: latitude, lon: longitude }, TARGET);
        box.setAttribute('visible', d < 30);
      });
    });
  </script>
</body>
</html>
