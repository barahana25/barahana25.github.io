<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <!-- ëª¨ë°”ì¼ì—ì„œ ì „ì²´ í™”ë©´Â·ì„¼ì„œ í—ˆìš© -->
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <!-- A-Frame + AR.js (location í¬í•¨ ë¹Œë“œ) -->
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar-nft.js"></script>
    <title>Location-based AR demo</title>
    <style>body{margin:0;overflow:hidden;font-family:sans-serif}</style>
  </head>

  <body>
    <!-- arjs system: videoTexture trueë©´ ë¨¼ ê±°ë¦¬ ë¬¼ì²´ë„ ì•ˆì •ì ìœ¼ë¡œ ë Œë”ë§ -->
    <a-scene
      embedded
      arjs="sourceType: webcam; videoTexture: true; debugUIEnabled: false"
      renderer="antialias: true; logarithmicDepthBuffer: true"
      vr-mode-ui="enabled: false"
    >
      <!-- GPS ì¹´ë©”ë¼ : ê¸°ê¸° ìœ„ì¹˜ë¥¼ ì§€ì† ê°±ì‹  -->
      <a-camera gps-camera rotation-reader></a-camera>
      <!-- 1. ê³ ì • ìœ„ì¹˜ì— ë‚˜íƒ€ë‚  3D ìƒì -->
      <a-box
        gps-entity-place="latitude: 36.3553302; longitude: 128.7025256;"
        material="color: #FF1493; opacity: 0.9"
        depth="2" height="2" width="2"
        scale="1 1 1"
        look-at="[gps-camera]"
      ></a-box>

      <!-- 2. GLTF ëª¨ë¸ ì˜ˆì‹œ (PokÃ©mon ë§ˆëƒ¥!) -->
      <!-- <a-entity
          gps-entity-place="latitude: 36.14570; longitude: 128.39212;"
          gltf-model="url(models/pikachu.glb)"
          scale="0.5 0.5 0.5"
          animation-mixer
          look-at="[gps-camera]"
      ></a-entity> -->
    </a-scene>

    <!-- ê°„ë‹¨í•œ ê±°ë¦¬-íŠ¸ë¦¬ê±°: 30 m ì´ë‚´ì¼ ë•Œë§Œ í‘œì‹œ -->
    <script>
      // ê±°ë¦¬ ê³„ì‚° í•¨ìˆ˜ (Haversine)
      function distanceMeters(pos1, pos2) {
        const R = 6371000;
        const toRad = deg => deg * Math.PI / 180;
        const dLat = toRad(pos2.lat - pos1.lat);
        const dLon = toRad(pos2.lon - pos1.lon);
        const a =
          Math.sin(dLat / 2) ** 2 +
          Math.cos(toRad(pos1.lat)) * Math.cos(toRad(pos2.lat)) *
          Math.sin(dLon / 2) ** 2;
        return 2 * R * Math.asin(Math.sqrt(a));
      }

      const TARGET = { lat: 36.3553302, lon: 128.7025256 };
      const box = document.querySelector('a-box');

      window.addEventListener('gps-camera-update-position', (e) => {
        const { latitude, longitude } = e.detail.position;
        const d = distanceMeters({lat: latitude, lon: longitude}, TARGET);
        box.setAttribute('visible', d < 30);           // 30 m ì•ˆìª½ì´ë©´ ë³´ì´ê²Œ
      });
      const info = document.getElementById('gpsDisplay');

      window.addEventListener('gps-camera-update-position', (e) => {
        const { latitude, longitude, accuracy } = e.detail.position;
        const d = distanceMeters({lat: latitude, lon: longitude}, TARGET);
        box.setAttribute('visible', d < 30);

        // â“ ì†Œìˆ˜ì  ë‘˜ì§¸ ìë¦¬ê¹Œì§€ í‘œì‹œ, â“‘ GPS ì˜¤ì°¨ë„ í•¨ê»˜ ì¶œë ¥
        info.textContent =
          `ğŸ“ ${latitude.toFixed(5)}, ${longitude.toFixed(5)}  |  Â±${Math.round(accuracy)} m`;
      });
    </script>
    <div id="gpsDisplay"
       style="
         position:fixed; bottom:0; left:0; width:100%;
         padding:6px 10px; background:rgba(0,0,0,0.6);
         color:#fff; font-size:14px; font-family:monospace;
         z-index:9999; text-align:center;">
      ìœ„ë„Â·ê²½ë„ ë¡œë”© ì¤‘â€¦
  </div>
  </body>
</html>
