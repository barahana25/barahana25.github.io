<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<title>위치기반 AR.js 데모</title>

<!-- ① A-Frame (권장 1.3.0) -->
<script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>

<!-- ② AR.js location-only + A-Frame glue -->
<script src="https://raw.githack.com/AR-js-org/AR.js/3.4.5/three.js/build/ar-threex-location-only.js"></script>
<script src="https://raw.githack.com/AR-js-org/AR.js/3.4.5/aframe/build/aframe-ar.js"></script>

<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<style>body{margin:0;overflow:hidden;font-family:sans-serif}</style>
</head>

<body>
<!-- ───────── GPS 상태 표시 바 ───────── -->
<div id="gpsDisplay"
     style="position:fixed;bottom:0;left:0;width:100%;
            padding:6px 10px;background:rgba(0,0,0,.65);
            color:#fff;font-size:14px;font-family:monospace;
            z-index:9999;text-align:center">
  위도·경도 로딩 중…
</div>

<!-- ───────── AR Scene ───────── -->
<a-scene
  vr-mode-ui="enabled:false"
  embedded
  renderer="antialias:true;alpha:true;logarithmicDepthBuffer:true"
  arjs="sourceType:webcam;videoTexture:true;debugUIEnabled:false">

  <!-- 카메라: new-location-based -->
  <a-camera gps-new-camera rotation-reader></a-camera>

  <!-- 목표 지점 30 m 이내에서만 나타날 박스 -->
  <a-box id="target"
         gps-new-entity-place="latitude:36.14570;longitude:128.39212;"
         depth="2" height="2" width="2"
         material="color:#FF1493;opacity:0.9"
         look-at="[gps-new-camera]"
         visible="false"></a-box>
</a-scene>

<script>
window.addEventListener('load', () => {
  const info   = document.getElementById('gpsDisplay');
  const camera = document.querySelector('[gps-new-camera]');
  const box    = document.getElementById('target');

  const TARGET = {lat:36.14570, lon:128.39212};
  const toRad  = d => d*Math.PI/180;
  const dist   = (p1,p2) => {
    const R=6371000;
    const dLat=toRad(p2.lat-p1.lat), dLon=toRad(p2.lon-p1.lon);
    const a=Math.sin(dLat/2)**2 +
             Math.cos(toRad(p1.lat))*Math.cos(toRad(p2.lat))*Math.sin(dLon/2)**2;
    return 2*R*Math.asin(Math.sqrt(a));
  };

  camera.addEventListener('gps-camera-update-position', e => {
    const {latitude, longitude, accuracy}=e.detail.position;
    info.textContent =
      `📍 ${latitude.toFixed(5)}, ${longitude.toFixed(5)}  ±${Math.round(accuracy)} m`;
    box.setAttribute('visible', dist({lat:latitude,lon:longitude}, TARGET) < 30);
  });
});
</script>
</body>
</html>
